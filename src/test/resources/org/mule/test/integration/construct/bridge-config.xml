<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesoft.org/schema/mule/core"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:vm="http://www.mulesoft.org/schema/mule/vm"
  xmlns:spring="http://www.springframework.org/schema/beans"
  xsi:schemaLocation="
       http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/3.0/mule.xsd
       http://www.mulesoft.org/schema/mule/vm http://www.mulesoft.org/schema/mule/vm/3.0/mule-vm.xsd
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

  <bridge name="synchronous-bridge"
          inboundAddress="vm://synchronous-bridge.in"
          outboundAddress="vm://maths-service.in" />

  <bridge name="asynchronous-bridge"
          exchange-pattern="one-way"
          inboundAddress="vm://asynchronous-bridge.in"
          outboundAddress="vm://log-service.in" />

  <bridge name="transforming-bridge"
          inboundAddress="vm://transforming-bridge.in"
          transformer-refs="byte-array-to-string append-bar"
          responseTransformer-refs="append-baz string-to-byte-array"
          outboundAddress="vm://echo-service.in" />

  <bridge name="endpoint-ref-bridge"
          inboundEndpoint-ref="endpoint-ref-bridge-channel"
          outboundEndpoint-ref="maths-service-channel" />

  <bridge name="child-endpoint-bridge">
    <vm:inbound-endpoint path="child-endpoint-bridge.in"
                         exchange-pattern="request-response" />
    <vm:outbound-endpoint path="maths-service.in"
                          exchange-pattern="request-response" />
  </bridge>
  
  <bridge name="exception-bridge"
          inboundAddress="vm://exception-bridge.in"
          outboundEndpoint-ref="maths-service-channel">
    <default-service-exception-strategy />
  </bridge>          

  <bridge name="transacted-bridge"
          transacted="true"
          inboundAddress="vm://transacted-bridge.in"
          outboundAddress="vm://transacted-maths-service.in" />

  <!--
        Test support
  -->
  <byte-array-to-string-transformer name="byte-array-to-string" />
  <append-string-transformer name="append-bar" message="bar"/>
  <append-string-transformer name="append-baz" message="baz"/>
  <string-to-byte-array-transformer name="string-to-byte-array" />

  <vm:endpoint name="endpoint-ref-bridge-channel"
               path="endpoint-ref-bridge.in"
               exchange-pattern="request-response" />
  
  <vm:endpoint name="maths-service-channel"
               path="maths-service.in"
               exchange-pattern="request-response" />

  <vm:endpoint name="echo-service-channel"
               path="echo-service.in"
               exchange-pattern="request-response" />
               
  <vm:endpoint name="log-service-channel"
               path="log-service.in"
               exchange-pattern="one-way" />

  <simple-service name="maths-service"
                  endpoint-ref="maths-service-channel"
                  component-class="org.mule.tck.services.SimpleMathsComponent" />

  <simple-service name="transactional-maths-service"
                  component-class="org.mule.tck.services.SimpleMathsComponent">
    <vm:inbound-endpoint path="transacted-maths-service.in">
      <vm:transaction action="JOIN_IF_POSSIBLE"/>
    </vm:inbound-endpoint>
  </simple-service>
                  
  <simple-service name="echo-service"
                  endpoint-ref="echo-service-channel"
                  component-class="org.mule.component.simple.EchoComponent" />
                  
  <simple-service name="log-service"
                  endpoint-ref="log-service-channel">
    <log-component />
  </simple-service>
</mule>