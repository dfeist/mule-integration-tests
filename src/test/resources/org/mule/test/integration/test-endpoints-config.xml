<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesource.org/schema/mule/core/2.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:spring="http://www.springframework.org/schema/beans" xmlns:vm="http://www.mulesource.org/schema/mule/vm/2.0"
    xmlns:file="http://www.mulesource.org/schema/mule/file/2.0"
    xmlns:file="http://www.mulesource.org/schema/mule/xml/2.0"
    xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://www.mulesource.org/schema/mule/core/2.0 http://www.mulesource.org/schema/mule/core/2.0/mule.xsd
       http://www.mulesource.org/schema/mule/vm/2.0 http://www.mulesource.org/schema/mule/vm/2.0/mule-vm.xsd
       http://www.mulesource.org/schema/mule/file/2.0 http://www.mulesource.org/schema/mule/file/2.0/mule-file.xsd
       http://www.mulesource.org/schema/mule/xml/2.0 http://www.mulesource.org/schema/mule/xml/2.0/mule-xml.xsd">

    <configuration serverId="server" defaultSynchronousEventTimeout="1001" />

    <vm:connector name="vmConnector1" />
    <vm:connector name="vmConnector2" />
    <test:connector name="testConnector1" />

    <file:file-to-string-transformer name="ObjectToFileMessage" />
    <xml:transformer-object-to-xml name="ObjectToXml" />
    <xml:transformer-xml-to-object name="XmlToObject" />

    <endpoint name="server1" address="tcp://localhost:45431" />
    <endpoint name="server2" address="tcp://localhost:45432" />
    <endpoint name="server3" address="tcp://localhost:45433" />
    <endpoint name="testEndpoint" address="vm://another.queue" connector="vmConnector1" transformer-ref="ObjectToXml" />
    <endpoint name="testEndpoint2" address="vm://yet.another.queue" connector="vmConnector1"
        transformer-ref="ObjectToXml" />

    <model name="main">
        <!-- Test sendEndpoint and receive endpoint as URIs where the test connector will be
            used from the above config and the stream connector will be create dymanically
        -->
        <service name="TestComponent1" implementation="org.mule.test.integration.service.TestComponent">
            <inbound-router>
                <inbound-endpoint address="test://localhost/test.queue" connector="testConnector1" />
            </inbound-router>
            <outbound-router>
                <router className="org.mule.routing.outbound.OutboundPassThroughRouter">
                    <endpoint address="stream://System.out" />
                </router>
            </outbound-router>
        </service>

        <!-- Will fore create of a new VM connector i.e. create=ALWAYS and uses the
            transformer defined in in the inboundTransformer. Note that the URI
            test://localhost/new.queue?create=ALWAYS&transformers=XmlToObject  achieves the same
            result -->
        <service name="TestComponent2" implementation="org.mule.test.integration.service.TestComponent">
            <inbound-router>
                <inbound-endpoint address="test://localhost/test.queue" createConnector="ALWAYS_CREATE"
                    transformers="XmlToObject" />
            </inbound-router>
        </service>

        <!-- Test uri endpoints for send and receive and Uri endpoints on the outbound router -->
        <service name="TestComponent3" implementation="org.mule.test.integration.service.TestComponent">
            <inbound-router>
                <inbound--endpoint name="testEndpoint" />
            </inbound-router>
            <outbound-router>
                <filtering-router>
                    <endpoint name="tcp1" address="tcp://localhost:60201" />
                </filtering-router>
                <multicasting-router>
                    <outbound-endpoint address="udp://localhost:56731" />
                    <outbound-endpoint address="test:/test.queue2" connector="testConnector1" />
                </multicasting-router>
            </outbound-router>
        </service>

        <!-- test Uri receiver endpoint specifying a provider with endpoint overrriden and
            test outbound router config combining endpoints -->
        <service name="TestComponent4" implementation="org.mule.test.integration.service.TestComponent">
            <inbound-router>
                <inbound-endpoint name="testEndpoint" address="vm://queue4" />
            </inbound-router>
            <outbound-router>
                <filtering-router>
                    <outbound-endpoint address="udp://localhost:56731" />
                    <outbound-endpoint ref="testEndpoint2" />
                </filtering-router>
            </outbound-router>
        </service>

        <service name="TestComponent5" implementation="org.mule.test.integration.service.TestComponent">

            <inbound-router>
                <inbound-endpoint address="vm://some.queue" connector="vmConnector2" />
            </inbound-router>

            <outbound-router>
                <filtering-router>
                    <outbound-endpoint ref="server1" />
                    <outbound-endpoint ref="server2" />
                </filtering-router>
            </outbound-router>
        </service>

        <service name="TestComponent6" implementation="org.mule.test.integration.service.TestComponent">
            <outbound-router>
                <filtering-router>
                    <outbound-endpoint ref="server3" />
                </filtering-router>
            </outbound-router>
        </service>
    </model>
    </mule>
